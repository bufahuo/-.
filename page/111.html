<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>账号管理 - 汽车租赁系统</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <style>
        body {background-color: #f2f3f5; margin: 0; padding: 0;}
        .layui-card {margin: 20px;}
        .layui-card-header {font-weight: bold;}
        .form-container {padding: 20px;}
        .layui-form-item {margin-bottom: 25px;}
        .tab-container {margin: 20px;}
        .account-avatar {width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 20px; overflow: hidden; border: 3px solid #eee;}
        .account-avatar img {width: 100%; height: 100%; object-fit: cover;}
        .avatar-upload {text-align: center; margin-top: 10px;}
        .danger-area {border-left: 3px solid #FF5722; padding-left: 15px; margin: 20px 0;}
        .layui-btn-danger {background-color: #FF5722;}
        .verify-code-group {display: flex; gap: 10px;}
        .verify-code-group .layui-input {flex: 1;}
        .verify-code-group button {width: 120px;}
    </style>
</head>
<body>
    <div class="layui-body" style="padding: 15px;">
        <div class="tab-container">
            <div class="layui-card">
                <div class="layui-card-header">账号管理中心</div>
                <div class="layui-card-body">
                    <div class="layui-tab layui-tab-brief" lay-filter="accountTab">
                        <ul class="layui-tab-title">
                            <li class="layui-this" lay-id="profile">个人资料</li>
                            <li lay-id="password">密码管理</li>
                            <li lay-id="注销">账号注销</li>
                        </ul>
                        <div class="layui-tab-content">
                            <!-- 个人资料维护 -->
                            <div class="layui-tab-item layui-show" id="profileTab">
                                <div class="layui-card">
                                    <div class="layui-card-header">个人资料维护</div>
                                    <div class="layui-card-body">
                                        <form class="layui-form form-container" lay-filter="profileForm">
                                            <div class="account-avatar">
                                                <img src="../images/avatar.jpg" id="avatarPreview">
                                            </div>
                                            <div class="avatar-upload">
                                                <button type="button" class="layui-btn layui-btn-primary" id="avatarUpload">
                                                    <i class="layui-icon">&#xe67c;</i>更换头像
                                                </button>
                                                <input type="file" id="avatarFile" style="display: none;" accept="image/*">
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">用户名</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="username" value="admin" class="layui-input" disabled>
                                                    <div class="layui-form-mid layui-word-aux">用户名不可修改</div>
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">昵称</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="nickname" value="系统管理员" lay-verify="required" placeholder="请输入昵称" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">手机号码</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="phone" value="13800138000" lay-verify="required|phone" placeholder="请输入手机号码" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">邮箱</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="email" value="admin@example.com" lay-verify="required|email" placeholder="请输入邮箱" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">性别</label>
                                                <div class="layui-input-block">
                                                    <input type="radio" name="sex" value="男" title="男" checked>
                                                    <input type="radio" name="sex" value="女" title="女">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">备注</label>
                                                <div class="layui-input-block">
                                                    <textarea name="remark" placeholder="请输入个人简介" class="layui-textarea">负责系统日常管理与维护</textarea>
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit lay-filter="saveProfile">保存修改</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 密码管理 -->
                            <div class="layui-tab-item" id="passwordTab">
                                <div class="layui-card">
                                    <div class="layui-card-header">修改密码</div>
                                    <div class="layui-card-body">
                                        <form class="layui-form form-container" lay-filter="passwordForm">
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">原密码</label>
                                                <div class="layui-input-block">
                                                    <input type="password" name="oldPassword" lay-verify="required|password" placeholder="请输入原密码" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">新密码</label>
                                                <div class="layui-input-block">
                                                    <input type="password" name="newPassword" lay-verify="required|password|min:6" placeholder="请输入新密码（至少6位）" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">确认新密码</label>
                                                <div class="layui-input-block">
                                                    <input type="password" name="confirmPassword" lay-verify="required|confirmPassword" placeholder="请再次输入新密码" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit lay-filter="changePassword">确认修改</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                                <div class="layui-card" style="margin-top: 20px;">
                                    <div class="layui-card-header">通过手机找回密码</div>
                                    <div class="layui-card-body">
                                        <form class="layui-form form-container" lay-filter="retrieveForm">
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">手机号码</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="retrievePhone" value="13800138000" lay-verify="required|phone" placeholder="请输入绑定的手机号码" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">验证码</label>
                                                <div class="layui-input-block verify-code-group">
                                                    <input type="text" name="verifyCode" lay-verify="required|length:6" placeholder="请输入验证码" class="layui-input">
                                                    <button type="button" class="layui-btn layui-btn-primary" id="getVerifyCode">获取验证码</button>
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">新密码</label>
                                                <div class="layui-input-block">
                                                    <input type="password" name="retrieveNewPassword" lay-verify="required|password|min:6" placeholder="请输入新密码（至少6位）" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn" lay-submit lay-filter="retrievePassword">找回密码</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 账号注销 -->
                            <div class="layui-tab-item" id="deleteTab">
                                <div class="layui-card">
                                    <div class="layui-card-header">账号注销</div>
                                    <div class="layui-card-body">
                                        <div class="danger-area">
                                            <p style="color: #FF5722; font-weight: bold;">注意：账号注销后将无法恢复，请谨慎操作！</p>
                                            <p>1. 注销账号后，您的所有个人数据将被清除</p>
                                            <p>2. 注销账号后，与该账号相关的订单信息将被匿名化处理</p>
                                            <p>3. 注销操作不可逆，一旦确认将无法恢复</p>
                                        </div>
                                        
                                        <form class="layui-form form-container" lay-filter="deleteForm">
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">输入密码确认</label>
                                                <div class="layui-input-block">
                                                    <input type="password" name="deletePassword" lay-verify="required" placeholder="请输入当前账号密码确认" class="layui-input">
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">注销原因</label>
                                                <div class="layui-input-block">
                                                    <select name="deleteReason" lay-verify="required">
                                                        <option value="">请选择注销原因</option>
                                                        <option value="不再使用">不再使用该系统</option>
                                                        <option value="功能不符合需求">功能不符合需求</option>
                                                        <option value="其他原因">其他原因</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">详细说明</label>
                                                <div class="layui-input-block">
                                                    <textarea name="deleteRemark" placeholder="请输入详细说明（选填）" class="layui-textarea"></textarea>
                                                </div>
                                            </div>
                                            
                                            <div class="layui-form-item">
                                                <div class="layui-input-block">
                                                    <button class="layui-btn layui-btn-danger" lay-submit lay-filter="deleteAccount">确认注销账号</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script>
        layui.use(['form', 'layer', 'element'], function() {
            var form = layui.form,
                layer = layui.layer,
                element = layui.element;
            
            // 自定义验证规则
            form.verify({
                password: function(value) {
                    if (!/^[a-zA-Z0-9]{6,16}$/.test(value)) {
                        return '密码需为6-16位字母或数字组合';
                    }
                },
                confirmPassword: function(value) {
                    var password = $(this.elem).parents('.layui-form-item').prev().find('input').val();
                    if (value !== password) {
                        return '两次输入密码不一致';
                    }
                },
                length: function(value, item) {
                    var len = $(item).attr('lay-verify').split(':')[1];
                    if (value.length != len) {
                        return '请输入' + len + '位字符';
                    }
                }
            });
            
            // 头像上传
            $('#avatarUpload').click(function() {
                $('#avatarFile').click();
            });
            
            $('#avatarFile').change(function(e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $('#avatarPreview').attr('src', e.target.result);
                        layer.msg('头像已预览，点击保存修改生效', {icon: 1});
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // 保存个人资料
            form.on('submit(saveProfile)', function(data) {
                // 模拟提交
                layer.msg('个人资料保存成功', {icon: 1}, function() {
                    // 实际项目中这里会提交到后端
                });
                return false;
            });
            
            // 修改密码
            form.on('submit(changePassword)', function(data) {
                if (data.field.oldPassword === '123456' && data.field.newPassword === data.field.confirmPassword) {
                    layer.msg('密码修改成功，请重新登录', {icon: 1}, function() {
                        // 实际项目中这里会提交到后端并跳转登录页
                    });
                } else if (data.field.oldPassword !== '123456') {
                    layer.msg('原密码不正确', {icon: 2});
                }
                return false;
            });
            
            // 获取验证码倒计时
            var countdown = 60;
            $('#getVerifyCode').click(function() {
                var $this = $(this);
                var phone = $('input[name="retrievePhone"]').val();
                
                if (!/^1[3-9]\d{9}$/.test(phone)) {
                    layer.msg('请输入正确的手机号码', {icon: 2});
                    return;
                }
                
                $this.attr('disabled', true).text('60秒后重发');
                var timer = setInterval(function() {
                    countdown--;
                    $this.text(countdown + '秒后重发');
                    if (countdown <= 0) {
                        clearInterval(timer);
                        $this.attr('disabled', false).text('获取验证码');
                        countdown = 60;
                    }
                }, 1000);
                
                layer.msg('验证码已发送', {icon: 1});
            });
            
            // 找回密码
            form.on('submit(retrievePassword)', function(data) {
                if (data.field.verifyCode === '123456') {
                    layer.msg('密码找回成功，请使用新密码登录', {icon: 1}, function() {
                        // 切换到登录标签页
                        element.tabChange('accountTab', 'password');
                    });
                } else {
                    layer.msg('验证码不正确', {icon: 2});
                }
                return false;
            });
            
            // 注销账号
            form.on('submit(deleteAccount)', function(data) {
                if (!data.field.deletePassword) {
                    layer.msg('请输入密码确认', {icon: 2});
                    return false;
                }
                
                // 二次确认
                layer.confirm('确定要注销账号吗？此操作不可逆，所有数据将被清除！', {
                    title: '警告',
                    icon: 3,
                    btn: ['确认注销', '取消']
                }, function(index) {
                    layer.close(index);
                    // 模拟注销操作
                    layer.msg('账号注销成功', {icon: 1}, function() {
                        // 实际项目中这里会提交到后端并跳转登录页
                        window.location.href = '../login.html';
                    });
                });
                
                return false;
            });
        });
    </script>
</body>
</html>